<!DOCTYPE html><html lang="en"><head><meta name="x-poe-datastore-behavior" content="local_only"><meta http-equiv="Content-Security-Policy" content="default-src 'self' 'unsafe-inline' 'unsafe-eval' data: blob: https://cdnjs.cloudflare.com https://cdn.jsdelivr.net https://code.jquery.com https://unpkg.com https://d3js.org https://threejs.org https://cdn.plot.ly https://stackpath.bootstrapcdn.com https://maps.googleapis.com https://cdn.tailwindcss.com https://ajax.googleapis.com https://kit.fontawesome.com https://cdn.datatables.net https://maxcdn.bootstrapcdn.com https://code.highcharts.com https://tako-static-assets-production.s3.amazonaws.com https://www.youtube.com https://fonts.googleapis.com https://fonts.gstatic.com https://pfst.cf2.poecdn.net https://puc.poecdn.net https://i.imgur.com https://wikimedia.org https://*.icons8.com https://*.giphy.com https://picsum.photos https://images.unsplash.com; frame-src 'self' https://www.youtube.com https://trytako.com; child-src 'self'; manifest-src 'self'; worker-src 'self'; upgrade-insecure-requests; block-all-mixed-content;">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shoulder Outcome Measures</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --secondary-color: #f0f4f8;
            --border-color: #cbd5e0;
            --text-color: #333;
            --success-color: #28a745;
            --fail-color: #dc3545;
            --copy-color: #17a2b8; /* Cyan for copy button */
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            background-color: #f9fafb;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        /* 3-Row Header Styles */
        .header-container {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 2px solid var(--secondary-color);
            padding-bottom: 20px;
        }
        .header-row-1 {
            font-size: 1.2rem;
            font-weight: 600;
            color: #555;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .header-row-2 {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--primary-color);
            margin: 5px 0;
        }
        .header-row-3 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #444;
        }
        
        /* Patient Info Grid */
        .patient-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
            padding: 15px;
            background-color: var(--secondary-color);
            border-radius: 6px;
        }

        .form-group { margin-bottom: 10px; }
        label { font-weight: bold; display: block; margin-bottom: 5px; }
        input[type="text"], input[type="date"], select {
            width: 100%; padding: 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px; box-sizing: border-box;
        }

        /* Tabs */
        .tabs {
            display: flex;
            border-bottom: 2px solid var(--border-color);
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab-btn {
            padding: 10px 20px;
            background: none; border: none;
            cursor: pointer; font-size: 16px;
            font-weight: bold; color: #666;
            outline: none; flex-grow: 1;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        /* Questions & Options */
        .question-block {
            margin-bottom: 25px;
            border-bottom: 1px solid #eee;
            padding-bottom: 15px;
        }

        .instruction-text {
            font-size: 0.95em;
            color: #555;
            margin-bottom: 10px;
            background-color: #f8f9fa;
            padding: 10px;
            border-left: 3px solid var(--primary-color);
        }

        .options-grid { display: grid; gap: 10px; }

        .option-btn {
            text-align: left; padding: 10px 15px;
            border: 1px solid var(--border-color);
            background: white; border-radius: 4px;
            cursor: pointer; transition: all 0.2s;
            display: flex; justify-content: space-between;
            align-items: center;
        }

        .option-btn:hover { background-color: var(--secondary-color); }
        
        .option-btn.selected {
            background-color: var(--primary-color);
            color: white; border-color: var(--primary-color);
        }

        .score-badge {
            background: #eee; padding: 2px 8px;
            border-radius: 10px; font-size: 0.85em; color: #333;
            min-width: 25px; text-align: center;
        }
        
        .option-btn.selected .score-badge {
            background: rgba(255,255,255,0.3); color: white;
        }

        /* Sliders */
        .slider-container { margin: 20px 0; text-align: center; }
        input[type=range] { width: 100%; cursor: pointer; }
        .slider-labels { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; }

        /* Results Box */
        .total-score-box {
            background-color: #2d3748;
            color: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            margin-top: 20px;
            position: sticky;
            bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            z-index: 100;
        }

        .score-display { font-size: 1.5em; font-weight: bold; }
        .cutoff-info { font-size: 0.9em; margin-top: 5px; opacity: 0.9; }
        
        .score-pass { color: #48bb78; } /* Green */
        .score-fail { color: #f56565; } /* Red */

        /* Action Buttons Container */
        .action-buttons {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .action-btn {
            flex: 1;
            padding: 15px;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 1.1em;
            cursor: pointer;
            text-align: center;
            transition: background-color 0.2s;
        }

        .print-btn { background-color: var(--success-color); }
        .print-btn:hover { background-color: #218838; }

        .copy-btn { background-color: var(--copy-color); }
        .copy-btn:hover { background-color: #138496; }

        .input-row { display: flex; gap: 10px; align-items: center; margin-bottom: 10px; }
        .input-row input { width: 80px; }

        /* Language Toggle */
        .lang-toggle-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 15px;
            align-items: center;
            gap: 10px;
        }
        .lang-btn {
            padding: 5px 10px;
            border: 1px solid var(--primary-color);
            background: white;
            color: var(--primary-color);
            cursor: pointer;
            border-radius: 4px;
            font-size: 0.9em;
        }
        .lang-btn.active {
            background: var(--primary-color);
            color: white;
        }
        .lang-tc { display: none; } /* Hidden by default */

        /* Toast Notification */
        #toast {
            visibility: hidden;
            min-width: 250px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 4px;
            padding: 16px;
            position: fixed;
            z-index: 200;
            left: 50%;
            bottom: 30px;
            transform: translateX(-50%);
            font-size: 17px;
            opacity: 0;
            transition: opacity 0.3s, bottom 0.3s;
        }

        #toast.show {
            visibility: visible;
            opacity: 1;
            bottom: 50px;
        }

        @media print {
            body { background: white; padding: 0; }
            .container { box-shadow: none; width: 100%; max-width: 100%; padding: 0; }
            .tabs, .action-buttons, .lang-toggle-container { display: none; }
            .tab-content { display: block !important; margin-bottom: 30px; page-break-inside: avoid; border-bottom: 2px solid black; }
            .total-score-box { position: static; color: black; background: white; border: 2px solid black; box-shadow: none; margin-top: 10px; padding: 10px; }
            .score-pass, .score-fail { color: black; } /* Remove color for print */
            .option-btn { border: none; padding: 5px 0; }
            .option-btn:not(.selected) { display: none; }
            .option-btn.selected { background: none; color: black; font-weight: bold; border: 1px solid #ccc; padding: 5px; }
            .score-badge { display: inline-block; background: #eee; color: black; margin-left: 10px;}
            
            /* Ensure header looks good on print */
            .header-container { border-bottom: 1px solid #000; }
            .header-row-1, .header-row-2, .header-row-3 { color: black; }
        }
    </style>
</head>
<body>

<div class="container">
    
    <div class="header-container">
        <div class="header-row-1">PWH Physio Sports team</div>
        <div class="header-row-2">Shoulder outcome measures</div>
        <div class="header-row-3">UCLA &amp; Constant-Murley</div>
    </div>
    
    <div class="patient-info">
        <div class="form-group">
            <label>Patient Name:</label>
            <input type="text" id="patientName" placeholder="Enter Name">
        </div>
        <div class="form-group">
            <label>Date:</label>
            <input type="date" id="assessDate">
        </div>
        <div class="form-group">
            <label>Dominant Hand:</label>
            <select id="domHand">
                <option value="R">Right</option>
                <option value="L">Left</option>
            </select>
        </div>
        <div class="form-group">
            <label>Affected Arm:</label>
            <select id="affArm">
                <option value="R">Right</option>
                <option value="L">Left</option>
            </select>
        </div>
    </div>

    <div class="tabs">
        <button class="tab-btn active" onclick="openTab('ucla')">UCLA Shoulder Score</button>
        <button class="tab-btn" onclick="openTab('constant-patient')">Constant-Murley (Patient)</button>
        <button class="tab-btn" onclick="openTab('constant-physician')">Constant-Murley (Physician)</button>
    </div>

    <!-- UCLA FORM -->
    <div id="ucla" class="tab-content active">
        <h2>UCLA Shoulder Score (Appendix B)</h2>
        
        <div class="question-block" id="ucla-q1">
            <label>1. Pain</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('ucla-q1', 1)">Present always and unbearable; strong medication frequently <span class="score-badge">1</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q1', 2)">Present always but bearable; strong medication occasionally <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q1', 4)">None or little at rest, present during light activities; salicylates frequently <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q1', 6)">Present during heavy or particular activities only; salicylates occasionally <span class="score-badge">6</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q1', 8)">Occasional and slight <span class="score-badge">8</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q1', 10)">None <span class="score-badge">10</span></button>
            </div>
        </div>

        <div class="question-block" id="ucla-q2">
            <label>2. Function</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('ucla-q2', 1)">Unable to use limb <span class="score-badge">1</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q2', 2)">Only light activities possible <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q2', 4)">Able to do light housework or most activities of daily living <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q2', 6)">Most housework, shopping, driving, hair/dressing possible; able to do hair and to dress and undress, including fastening brassiere <span class="score-badge">6</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q2', 8)">Slight restriction only; able to work above shoulder level <span class="score-badge">8</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q2', 10)">Normal activities <span class="score-badge">10</span></button>
            </div>
        </div>

        <div class="question-block" id="ucla-q3">
            <label>3. Active Forward Flexion</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('ucla-q3', 0)"> &lt; 30° <span class="score-badge">0</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q3', 1)">30-45° <span class="score-badge">1</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q3', 2)">45-90° <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q3', 3)">90-120° <span class="score-badge">3</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q3', 4)">120-150° <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q3', 5)"> &gt; 150° <span class="score-badge">5</span></button>
            </div>
        </div>

        <div class="question-block" id="ucla-q4">
            <label>4. Strength of Forward Flexion (Manual Muscle Testing)</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('ucla-q4', 5)">Grade 5 (Normal) <span class="score-badge">5</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q4', 4)">Grade 4 (Good) <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q4', 3)">Grade 3 (Fair) <span class="score-badge">3</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q4', 2)">Grade 2 (Poor) <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q4', 1)">Grade 1 (Muscle contraction) <span class="score-badge">1</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q4', 0)">Grade 0 (Nothing) <span class="score-badge">0</span></button>
            </div>
        </div>

        <div class="question-block" id="ucla-q5">
            <label>5. Satisfaction of Patient</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('ucla-q5', 5)">Satisfied and better <span class="score-badge">5</span></button>
                <button class="option-btn" onclick="selectOption('ucla-q5', 0)">Not satisfied and worse <span class="score-badge">0</span></button>
            </div>
        </div>

        <div class="total-score-box">
            <div class="score-display">UCLA Total Score: <span id="ucla-total" class="score-fail">0</span> / 35</div>
            <div class="cutoff-info">Cut-off point: 27 (Score ≥ 27 is Good/Excellent)</div>
        </div>
    </div>

    <!-- CONSTANT PATIENT FORM -->
    <div id="constant-patient" class="tab-content">
        
        <div class="lang-toggle-container">
            <span>Language: </span>
            <button class="lang-btn active" id="btn-en" onclick="setLanguage('en')">English</button>
            <button class="lang-btn" id="btn-tc" onclick="setLanguage('tc')">中文 (Traditional)</button>
        </div>

        <h2>Constant-Murley Score - Patient Portion (Appendix C)</h2>
        
        <!-- PAIN -->
        <div class="question-block">
            <label>
                <span class="lang-en">A. Pain Score (Visual Analog Scale)</span>
                <span class="lang-tc">甲: 疼痛程度</span>
            </label>
            <p>
                <span class="lang-en">Indicate the highest pain level you have experienced in your shoulder during ordinary activities within the last 24 hours. To do this, set a mark on the line.</span>
                <span class="lang-tc">請於下列線上標記出你於最近24小時進行日常活動時所感到肩關節的最高疼痛程度。</span>
            </p>
            <div class="slider-container">
                <!-- 
                   LOGIC: 
                   Left (0 on slider) = No Pain (15 points)
                   Right (15 on slider) = Intolerable (0 points)
                -->
                <input type="range" id="cm-pain-slider" min="0" max="15" value="0" oninput="updateCMScores()">
                <div class="slider-labels">
                    <span>
                        <span class="lang-en">No Pain (15)</span>
                        <span class="lang-tc">無痛</span>
                    </span>
                    <span>
                        <span class="lang-en">Intolerable Pain (0)</span>
                        <span class="lang-tc">難以忍受的疼痛</span>
                    </span>
                </div>
                <p>Score: <span id="cm-pain-val">15</span> points</p>
            </div>
        </div>

        <h3>
            <span class="lang-en">B. Activities of Daily Living</span>
            <span class="lang-tc">乙: 日常活動</span>
        </h3>
        
        <p class="lang-tc" style="margin-bottom: 15px;">以下四條問題將會詢問你於最近一周的日常活動情況。</p>

        <!-- Q1 SLEEP -->
        <div class="question-block" id="cm-q1">
            <label>
                <span class="lang-en">1. Is your sleep disturbed by your shoulder?</span>
                <span class="lang-tc">1. 你的肩關節情況有否影響你的正常睡眠?</span>
            </label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('cm-q1', 2)">
                    <span class="lang-en">Undisturbed sleep</span>
                    <span class="lang-tc">睡眠正常</span>
                    <span class="score-badge">2</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q1', 1)">
                    <span class="lang-en">Occasional disturbance</span>
                    <span class="lang-tc">因肩痛難以入睡，但最後能入睡</span>
                    <span class="score-badge">1</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q1', 0)">
                    <span class="lang-en">Every night</span>
                    <span class="lang-tc">因肩痛難以入睡</span>
                    <span class="score-badge">0</span>
                </button>
            </div>
        </div>

        <!-- Q2 WORK -->
        <div class="question-block">
            <label>
                <span class="lang-en">2. Daily Work Capacity (Visual Analog Scale)</span>
                <span class="lang-tc">2. 你的肩關節情況有多影響你的日常活動? (請於下列線上標記)</span>
            </label>
            <p>
                <span class="lang-en">How much of your normal daily work does your shoulder allow you to perform? (Indicate by setting a mark on the line)</span>
                <span class="lang-tc"></span>
            </p>
            <div class="slider-container">
                <!-- 
                   LOGIC: 
                   Left (0 on slider) = Unaffected (4 points)
                   Right (4 on slider) = Affected (0 points)
                -->
                <input type="range" id="cm-work-slider" min="0" max="4" value="0" oninput="updateCMScores()">
                <div class="slider-labels">
                    <span>
                        <span class="lang-en">Unaffected (4)</span>
                        <span class="lang-tc">完全不受影響</span>
                    </span>
                    <span>
                        <span class="lang-en">Totally Affected (0)</span>
                        <span class="lang-tc">完全受到影響</span>
                    </span>
                </div>
                <p>Score: <span id="cm-work-val">4</span> points</p>
            </div>
        </div>

        <!-- Q3 RECREATION -->
        <div class="question-block">
            <label>
                <span class="lang-en">3. Recreational Activity (Visual Analog Scale)</span>
                <span class="lang-tc">3. 你的肩關節情況有多影響你的正常娛樂/運動? (請於下列線上標記)</span>
            </label>
            <p>
                <span class="lang-en">How much of your normal recreational activity does your shoulder allow you to perform? (Indicate by setting a mark on the line)</span>
                <span class="lang-tc"></span>
            </p>
            <div class="slider-container">
                <!-- 
                   LOGIC: 
                   Left (0 on slider) = Unaffected (4 points)
                   Right (4 on slider) = Affected (0 points)
                -->
                <input type="range" id="cm-rec-slider" min="0" max="4" value="0" oninput="updateCMScores()">
                <div class="slider-labels">
                    <span>
                        <span class="lang-en">Unaffected (4)</span>
                        <span class="lang-tc">完全不受影響</span>
                    </span>
                    <span>
                        <span class="lang-en">Totally Affected (0)</span>
                        <span class="lang-tc">完全受到影響</span>
                    </span>
                </div>
                <p>Score: <span id="cm-rec-val">4</span> points</p>
            </div>
        </div>

        <!-- Q4 HAND POSITION -->
        <div class="question-block" id="cm-q4">
            <label>
                <span class="lang-en">To which level can you use your hand comfortably? (Please check only the most advancement movement)</span>
                <span class="lang-tc">4. 請選出你於無痛的情況下能夠並最難達到的身體部位。 (只選出下列一個最適合的答案)</span>
            </label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('cm-q4', 0)">
                    <span class="lang-en">Below the waist</span>
                    <span class="lang-tc">腰部以下</span>
                    <span class="score-badge">0</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q4', 2)">
                    <span class="lang-en">Up to the waist</span>
                    <span class="lang-tc">達到腰間</span>
                    <span class="score-badge">2</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q4', 4)">
                    <span class="lang-en">Up to the xiphoid/sternum</span>
                    <span class="lang-tc">達到劍骨</span>
                    <span class="score-badge">4</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q4', 6)">
                    <span class="lang-en">Up to the neck</span>
                    <span class="lang-tc">達到頸部</span>
                    <span class="score-badge">6</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q4', 8)">
                    <span class="lang-en">Up to the top of the head</span>
                    <span class="lang-tc">達到頭頂</span>
                    <span class="score-badge">8</span>
                </button>
                <button class="option-btn" onclick="selectOption('cm-q4', 10)">
                    <span class="lang-en">Above the head</span>
                    <span class="lang-tc">舉高過頭頂</span>
                    <span class="score-badge">10</span>
                </button>
            </div>
        </div>

        <div class="total-score-box">
            <div class="score-display">CM Patient Score (Pain + ADL): <span id="cm-patient-total">0</span> / 35</div>
        </div>
    </div>

    <!-- CONSTANT PHYSICIAN FORM -->
    <div id="constant-physician" class="tab-content">
        <h2>Constant-Murley Score - Physician Portion (Appendix C)</h2>

        <h3>C: Movement</h3>
        <p class="instruction-text">
            Four different active and pain---free movements of the arm are performed. If the arm can be lifted to 140 degrees with pain and 110 degrees without pain in question 1,2, then a range of motion of 110 degrees is recorded. The tester first shows the desired movement, which the patient then performs. All exercises are done with the test subject standing with their feet pointing directly forwards and a shoulder width apart.<br>
            1,2. Forward and lateral elevation are recorded with a long---armed goniometer. Only the affected arm performs movements.
        </p>
        
        <div class="question-block" id="cm-flex">
            <label>1. Forward Flexion (Degrees)</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('cm-flex', 0)">0-30° <span class="score-badge">0</span></button>
                <button class="option-btn" onclick="selectOption('cm-flex', 2)">31-60° <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('cm-flex', 4)">61-90° <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('cm-flex', 6)">91-120° <span class="score-badge">6</span></button>
                <button class="option-btn" onclick="selectOption('cm-flex', 8)">121-150° <span class="score-badge">8</span></button>
                <button class="option-btn" onclick="selectOption('cm-flex', 10)">&gt; 151° <span class="score-badge">10</span></button>
            </div>
        </div>

        <div class="question-block" id="cm-abd">
            <label>2. Abduction (Degrees)</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('cm-abd', 0)">0-30° <span class="score-badge">0</span></button>
                <button class="option-btn" onclick="selectOption('cm-abd', 2)">31-60° <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('cm-abd', 4)">61-90° <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('cm-abd', 6)">91-120° <span class="score-badge">6</span></button>
                <button class="option-btn" onclick="selectOption('cm-abd', 8)">121-150° <span class="score-badge">8</span></button>
                <button class="option-btn" onclick="selectOption('cm-abd', 10)">&gt; 151° <span class="score-badge">10</span></button>
            </div>
        </div>

        <div class="question-block">
            <label>3. External rotation performed without help and the hands should be placed behind and above the head without touching the head. Movements are performed by both arms simultaneously but recorded only for the affected side. The movements must be performed painlessly. Please check all that apply.</label>
            <div class="options-grid">
                <button class="option-btn multi-select" onclick="toggleMultiOption(this, 2)">Hands behind head, elbows forward <span class="score-badge">+2</span></button>
                <button class="option-btn multi-select" onclick="toggleMultiOption(this, 2)">Hands behind head, elbows back <span class="score-badge">+2</span></button>
                <button class="option-btn multi-select" onclick="toggleMultiOption(this, 2)">Hands to top of head, elbows forward <span class="score-badge">+2</span></button>
                <button class="option-btn multi-select" onclick="toggleMultiOption(this, 2)">Hands to top of head, elbows back <span class="score-badge">+2</span></button>
                <button class="option-btn multi-select" onclick="toggleMultiOption(this, 2)">Full elevation of arms <span class="score-badge">+2</span></button>
            </div>
            <p>ER Score: <span id="er-score">0</span></p>
        </div>

        <div class="question-block" id="cm-ir">
            <label>Internal rotation is performed without help and the subject should use their thumb to point to the specified anatomic landmarks. Movements are performed only with the affected arm. The movements must be performed painlessly. Please check only the box for the most advanced movement.</label>
            <div class="options-grid">
                <button class="option-btn" onclick="selectOption('cm-ir', 0)">Lateral aspect of thigh <span class="score-badge">0</span></button>
                <button class="option-btn" onclick="selectOption('cm-ir', 2)">Behind the buttock <span class="score-badge">2</span></button>
                <button class="option-btn" onclick="selectOption('cm-ir', 4)">Sacroiliac joint <span class="score-badge">4</span></button>
                <button class="option-btn" onclick="selectOption('cm-ir', 6)">Waist <span class="score-badge">6</span></button>
                <button class="option-btn" onclick="selectOption('cm-ir', 8)">12th thoracic vertebra <span class="score-badge">8</span></button>
                <button class="option-btn" onclick="selectOption('cm-ir', 10)">Interscapular level <span class="score-badge">10</span></button>
            </div>
        </div>

        <div class="question-block">
            <label>D: Strength</label>
            <p class="instruction-text">
                Strength is measured with a dynamometer. The test is done with the test subject standing with t heir feet pointing directly forwards and a shoulder width apart. The arm should be abducted 90 degrees in the scapular plane. If the arm cannot be elevated to 90 degrees, a score of 0 points is given. The wrist is pronated so the palm faces down and the elbow is stretched as much as possible. The strap of the dynamometer should be placed around the wrist of the test subject so that it lies over the long head of the ulna. The test subjected is instructed to push maximally upwards for 5 seconds and is given 3 attempts Score corresponds to force in pounds (Max 25). If kg, multiply by 2.2..
            </p>
            <div class="input-row">
                <label>Measured Pounds:</label>
                <input type="number" id="strength-lbs" min="0" max="25" oninput="updateCMScores()">
                <span>(Max 25)</span>
            </div>
        </div>

        <div class="total-score-box">
            <div>CM Physician Score (ROM + Strength): <span id="cm-physician-total">0</span> / 65</div>
            <hr style="border-color: rgba(255,255,255,0.3); margin: 10px 0;">
            <div class="score-display">TOTAL CONSTANT SCORE: <span id="cm-grand-total" class="score-fail">0</span> / 100</div>
            <div class="cutoff-info">Cut-off point: 80 (Score ≥ 80 is Satisfactory)</div>
        </div>
    </div>

    <!-- ACTION BUTTONS -->
    <div class="action-buttons">
        <button class="action-btn print-btn" onclick="window.print()">Print / Save as PDF</button>
        <button class="action-btn copy-btn" onclick="copyToClipboard()">Copy Text for EMR</button>
    </div>

</div>

<!-- Toast Notification Element -->
<div id="toast">Text copied to clipboard!</div>

<script>
    // State management
    const scores = {
        ucla: { q1: 0, q2: 0, q3: 0, q4: 0, q5: 0 },
        cmPatient: { pain: 15, sleep: 0, work: 4, rec: 4, hand: 0 }, // Init with max/min defaults based on slider pos 0
        cmPhysician: { flex: 0, abd: 0, er: 0, ir: 0, strength: 0 }
    };

    function openTab(tabId) {
        document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        const btnIndex = Array.from(document.querySelectorAll('.tab-content')).findIndex(el => el.id === tabId);
        document.querySelectorAll('.tab-btn')[btnIndex].classList.add('active');
    }

    function setLanguage(lang) {
        // Toggle buttons
        document.getElementById('btn-en').classList.toggle('active', lang === 'en');
        document.getElementById('btn-tc').classList.toggle('active', lang === 'tc');

        // Toggle Text
        const enElements = document.querySelectorAll('.lang-en');
        const tcElements = document.querySelectorAll('.lang-tc');

        if (lang === 'en') {
            enElements.forEach(el => el.style.display = 'inline');
            tcElements.forEach(el => el.style.display = 'none');
        } else {
            enElements.forEach(el => el.style.display = 'none');
            tcElements.forEach(el => el.style.display = 'inline');
        }
    }

    function selectOption(groupId, value) {
        const container = document.getElementById(groupId);
        container.querySelectorAll('.option-btn').forEach(btn => btn.classList.remove('selected'));
        event.currentTarget.classList.add('selected');

        if (groupId.startsWith('ucla')) {
            const key = groupId.split('-')[1];
            scores.ucla[key] = value;
            calculateUCLA();
        } else if (groupId.startsWith('cm')) {
            const key = groupId.split('-')[1];
            if(key === 'q1') scores.cmPatient.sleep = value;
            if(key === 'q4') scores.cmPatient.hand = value;
            if(key === 'flex') scores.cmPhysician.flex = value;
            if(key === 'abd') scores.cmPhysician.abd = value;
            if(key === 'ir') scores.cmPhysician.ir = value;
            updateCMScores();
        }
    }

    function toggleMultiOption(btn, value) {
        btn.classList.toggle('selected');
        const selectedBtns = btn.parentElement.querySelectorAll('.selected');
        let total = 0;
        selectedBtns.forEach(b => total += value);
        scores.cmPhysician.er = total;
        document.getElementById('er-score').innerText = total;
        updateCMScores();
    }

    function calculateUCLA() {
        let total = 0;
        for (let key in scores.ucla) {
            total += scores.ucla[key];
        }
        const totalEl = document.getElementById('ucla-total');
        totalEl.innerText = total;
        
        // Cut-off Logic (27)
        if (total >= 27) {
            totalEl.className = 'score-pass';
        } else {
            totalEl.className = 'score-fail';
        }
    }

    function updateCMScores() {
        // Slider Logic: 
        // For Pain: Left(0) = 15pts, Right(15) = 0pts. Formula: 15 - val
        // For Work/Rec: Left(0) = 4pts, Right(4) = 0pts. Formula: 4 - val
        
        const painSliderVal = parseInt(document.getElementById('cm-pain-slider').value) || 0;
        const workSliderVal = parseInt(document.getElementById('cm-work-slider').value) || 0;
        const recSliderVal = parseInt(document.getElementById('cm-rec-slider').value) || 0;

        const painScore = 15 - painSliderVal;
        const workScore = 4 - workSliderVal;
        const recScore = 4 - recSliderVal;

        document.getElementById('cm-pain-val').innerText = painScore;
        document.getElementById('cm-work-val').innerText = workScore;
        document.getElementById('cm-rec-val').innerText = recScore;

        scores.cmPatient.pain = painScore;
        scores.cmPatient.work = workScore;
        scores.cmPatient.rec = recScore;

        const patientTotal = scores.cmPatient.pain + scores.cmPatient.sleep + scores.cmPatient.work + scores.cmPatient.rec + scores.cmPatient.hand;
        document.getElementById('cm-patient-total').innerText = patientTotal;

        let strengthVal = parseFloat(document.getElementById('strength-lbs').value) || 0;
        if (strengthVal > 25) strengthVal = 25;
        scores.cmPhysician.strength = strengthVal;

        const physicianTotal = scores.cmPhysician.flex + scores.cmPhysician.abd + scores.cmPhysician.er + scores.cmPhysician.ir + scores.cmPhysician.strength;
        document.getElementById('cm-physician-total').innerText = physicianTotal;

        const grandTotal = patientTotal + physicianTotal;
        const grandTotalEl = document.getElementById('cm-grand-total');
        grandTotalEl.innerText = grandTotal;

        // Cut-off Logic (80)
        if (grandTotal >= 80) {
            grandTotalEl.className = 'score-pass';
        } else {
            grandTotalEl.className = 'score-fail';
        }
    }

    function copyToClipboard() {
        // Gather Info
        const name = document.getElementById('patientName').value || "N/A";
        const date = document.getElementById('assessDate').value || "N/A";
        const dom = document.getElementById('domHand').value;
        const aff = document.getElementById('affArm').value;

        // UCLA
        const uclaTotal = document.getElementById('ucla-total').innerText;

        // Constant Calculation
        const cmPain = scores.cmPatient.pain;
        const cmADL = scores.cmPatient.sleep + scores.cmPatient.work + scores.cmPatient.rec + scores.cmPatient.hand;
        const cmROM = scores.cmPhysician.flex + scores.cmPhysician.abd + scores.cmPhysician.er + scores.cmPhysician.ir;
        const cmStrength = scores.cmPhysician.strength;
        const cmTotal = document.getElementById('cm-grand-total').innerText;

        const textToCopy = `SHOULDER OUTCOME MEASURES\n` +
            `Patient: ${name}\n` +
            `Date: ${date}\n` +
            `Dominant: ${dom} / Affected: ${aff}\n` +
            `--------------------------------\n` +
            `UCLA SHOULDER SCORE: ${uclaTotal}/35\n` +
            `--------------------------------\n` +
            `CONSTANT-MURLEY SCORE\n` +
            `Pain: ${cmPain}/15\n` +
            `ADL: ${cmADL}/20\n` +
            `ROM: ${cmROM}/40\n` +
            `Strength: ${cmStrength}/25\n` +
            `TOTAL: ${cmTotal}/100`;

        navigator.clipboard.writeText(textToCopy).then(function() {
            showToast();
        }, function(err) {
            alert('Could not copy text automatically. Please check permissions.');
        });
    }

    function showToast() {
        var x = document.getElementById("toast");
        x.className = "show";
        setTimeout(function(){ x.className = x.className.replace("show", ""); }, 3000);
    }

    document.getElementById('assessDate').valueAsDate = new Date();
</script>



</body></html>